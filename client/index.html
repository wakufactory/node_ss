<!DOCTYPE html>
<html>
<script src="js/util.js"></script>
<script src="js/api.js"></script>
<script>
onload = function() {
	API.get().then(function(data) {
		console.log(data) ;
	}).catch(function(err) {
		console.log(err) ;
	})
	
	$I('#send').$E('click',function(e) {
		e.preventDefault() ;
		
		var f = new FormData($$('#f0')) ;
		console.log(f) ;
		var data = {'tt':$$('input[name=tt]')[0].value,'t2':$$('textarea[name=t2]')[0].value}; 
		API.post(JSON.stringify(data)).then(function(res) {
			console.log("posted") ;
			console.log(res) ;
		});
		return false ;
	})
	
	$I('#drop').$E('dragover',function(e){
		e.preventDefault();
		return false ;
	});
	$I('#drop').$E('drop',function(e){
		e.preventDefault();
		console.log("drop") ;

		var tmp = (e.dataTransfer.files) ;
		if(!tmp.length) return false ;
		
		var files = Array.prototype.slice.call(tmp, 0, tmp.length);
		console.log(files) ;
		files.forEach(function(f){
			var reader = new FileReader() ;
			reader.onload = function(e) {
				console.log(f.name) ;
				API.upload((f.name),f).then(function(res){
					console.log("uploaded");
					console.log(res) ;
				})
			}
			reader.readAsArrayBuffer(f) ;
		})
		return false ;
	});
}
</script>
<link rel=stylesheet href="css/uploader.css"/>
<body id=drop>
<h1>HOGE</h1>
<form method="post" action="/api/"  id=f0>
<input type="text" name=tt>
<textarea name=t2></textarea>
<button id=send>send</button>
</form>
</body>
</html>